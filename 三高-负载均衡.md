# 三高项目 负载均衡

## 指标

并发数：

1. 并发的用户数。有一部分用户使用业务，另外一部分用户 挂机，没有具体操作。
2. 并发连接数。用户和服务器之间的连接。一部分连接在传输数据，一部分连接 仅仅连接而已。
3. 并发请求数。请求静态数据，有可能是写操作。
4. 并发线程数。系统内，并发的线程数目。

同时服务的调用方的数量。

吞吐量：单位时间内，能接受和返回的数据请求量。

1. 看业务逻辑。
2. 看请求数据。

TPS：Transaction Per Second。每秒进行的事务的数目。（整体定义事务的 请求、操作、返回）。

QPS：Queries Per Second。每秒查询量。

Tps和Qps的关系：打开首页就是一个事务。由具体的场景来决定。一个完整功能。

平均响应时间：。响应时间（用户的角度）（请求发出， 接受到响应，之间的时间）

所有响应时间的平均值。

可靠性指标：平均无故障时间。系统上线，到第一次发生故障，运行时间的平均值。

公式计算：

阿姆达尔定律：

加速比：优化前的响应时间/优化后的响应时间。r。

增强比例：某个模块的响应时间/总时间。  &#x3c;=1，p。

整体系统的平均响应时间：t新 = t老时间 * ((1-p)+ p/r)。

整体系统的加速比：1/((1-p)+ p/r)。

目的：优化 P值大的系统。加大r。

100个系统，优化哪个？

指标之间的关系：

并发数对吞吐量：

并发数 对 响应时间 互相影响：

用户角度，

系统角度：恶性循环。

可靠性指标和其他指标。

---

第一个优化：并发数。减少。防止系统并发数过高。

开发工程师，限流 拉到。

架构师，

日常方案、工业设计。分流。

分流

把原来指向一个系统的请求，分散到不同的系统上。

将 请求 到达系统前的 各个阶段   ，对请求进行分流。

DNS: 域名解析成IP地址。（数据库、map+接口）

A（Address）记录。ip。

CName（Canonical   Name）记录。域名到域名。

dns负载均衡：域名添加多个A记录（IP地址）。

cdn：将请求发到：距离用户网络拓扑最近的服务器。（拓扑的近  是动态变化的，网络负载，内容可用性，设备工作状况）

分流：

一举两得：1.减少 每个系统的并发数。2。让用户访问离他最近的系统（网络拓扑最近），降低网络延时，减少平均响应时间。

部署成本 增高，数据的同步 会复杂。（cdn 服务商）。

# CDN

占用流量大，不经常变。

cdn节点、缓存节点、边缘节点。

源站。

===

减少了系统并发数。

减少了平均响应时间。

减少了网络拥堵。

==

缓存 精通内容：配置规则列表决定哪些数据需要缓存。

动态内容：去源站。

分流。

---

cdn原理。

怎么学最快：自己设计。

请求的目的地是 taobao.com, 不让用户到真正的服务器上,  将请求 打到离我最近的节点。

拦截。

知道用户发出请求的源IP，就知道用户的位置。然后找一个合适的cdn节点，将请求发过去就OK。

cdn节点，去请求源站。

===

cdn原理总结：

1. 注册中心。
2. 请求实际服务。

===

动态内容怎么办？

## 直连方案

解决源站分流问题。

另外一个角度。参与这个功能的角色去分析。

用户。

源站。

拦截。（注册中心=地址映射）

---

cdn 完了。

静态内容，动态内容，如何进行分流。

干之前 总找问题，是一种逃避。

---

好的架构，设计不出来。好的架构一定是演化来的。

追求完美。

---

前提：对用户有预估。升级。买cdn。

最开始你一个人：硬编码。dic表：写死到代码中。数据库中。

---

定律。

角度。
